matrix:
  include:
  - os: linux
    dist: trusty
    sudo: required

language: c++
before_install:
#  - if [ "$TRAVIS_EVENT_TYPE" != "pull_request" ]; then openssl aes-256-cbc -K $encrypted_8b763c087de9_key -iv $encrypted_8b763c087de9_iv -in pxscene-build.pem.enc -out /tmp/pxscene-build.pem -d; fi
#  - if [ "$TRAVIS_EVENT_TYPE" != "pull_request" ]; then  eval "$(ssh-agent -s)"; fi
#  - if [ "$TRAVIS_EVENT_TYPE" != "pull_request" ]; then  chmod 0600 /tmp/pxscene-build.pem; fi
#  - if [ "$TRAVIS_EVENT_TYPE" != "pull_request" ]; then  ssh-add /tmp/pxscene-build.pem; fi
  - if [ "$TRAVIS_EVENT_TYPE" = "cron" ]; then ./ci/auto_merge_coverity.sh; fi
  - ./ci/before_install.sh
#  - if [ "$TRAVIS_EVENT_TYPE" != "cron" ] && {[ "$TRAVIS_EVENT_TYPE" = "push" ] || [ "$TRAVIS_EVENT_TYPE" = "pull_request" ]}; then export PATH=/usr/local/opt/ccache/libexec:$PATH; fi
# NOTE THAT COVERITY IS COMPATIBLE WITH gcc 7; upload to coverity fails when using gcc 6 
#  - if [ "$TRAVIS_EVENT_TYPE" != "cron" ] && [ "$TRAVIS_OS_NAME" = "linux" ]; then  export CC=/usr/bin/gcc-6; export CXX=/usr/bin/g++-6 ; sudo ln -s /usr/bin/gcc-6 /usr/local/bin/gcc ; sudo ln -s /usr/bin/g++-6 /usr/local/bin/g++ ; fi
  - if [ "$TRAVIS_EVENT_TYPE" != "cron" ] && {[ "$TRAVIS_EVENT_TYPE" = "push" ] || [ "$TRAVIS_EVENT_TYPE" = "pull_request" ]}; then echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-; fi
#  - gcc -v && g++ -v 


install:
  - if [ "$TRAVIS_EVENT_TYPE" != "cron" ]; then ./ci/install.sh; fi
before_script:
  - if [ "$TRAVIS_EVENT_TYPE" != "cron" ]; then ./ci/before_script.sh; fi
script:
  - if [ "$TRAVIS_EVENT_TYPE" != "cron" ]; then ./ci/clean_coverity.sh; fi

addons:
  coverity_scan:
    project:
      name: "conniefry/pxCore"
      description: "Build submitted via Travis CI"
    notification_email: constance_fry@cable.comcast.com
    build_command_prepend: "echo build prepend"
    build_command:   "./ci/make_coverity.sh"
    branch_pattern: coverity_scan_2
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - g++-6

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: A0VqzRLi/O7t/IpigCJO7mPHU4MXDdhsJMTSJjg3J4iP8putiYP35ky7vBykutbTFYoYoC/EBf1eyBhB+Mc8UHB95qRmIQw/zldLnBHKDWFB6vv1Hfbon8/zkB01NpDo+WdCnKNkjBcku0BfL/eUs6opCiDOn9qXBShR+0cR11qxgpZm+PNlIUygGYbcxRzWQqEvEycj0wTCFedFXJUvuLFN1Zm/SaVUdG+SRKty0PGTJSM+jc1olieuv6gyuqQZsty5pmCJsYW/B98Ux8F62itlY3jrVh0iCU4C3w1V6/oisJRuM1ugTklDioWP39woQNZNNMP8l2SMc275v/gBK+z3SYmZH02N2l9i2JxC/XJNddaR1R9/TGJ0yTVxbxtwWL9C+v7C4Lei11u3qnVeABBC58HVZSHW83f0QCfZVmcNMK1Xd7sJvzrm45UiHLyFj0OsK/5zVywcWykiB2w2P57oItu6sVhHE1Lb8bwVIdsm4gg8p6KMairq0Hl8zgHb7e7YLSZyXtFotEKBk8Ac8vK6u4kLaDJlovzRfPgy/n4nMT6P0UT/AOONav4fVrDYV776ugKGBgZGqyNPpBzq+9Jmmk7VgaHg7QNH+wMXlu/g2jvbQiLGIx9fXQ1DJecEXuvsf2t7bexSRx3r3r7jJ16vk4YbXeLSvxhGF8p/NII="


